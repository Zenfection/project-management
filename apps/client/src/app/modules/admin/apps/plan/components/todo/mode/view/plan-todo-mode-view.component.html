<div class="mb-4 flex items-center justify-between" *ngrxLet="task$ as task">
  <div class="flex items-center gap-2">
    <button
      type="button"
      mat-mini-fab
      (click)="toggleEditMode(true)"
      class="overflow-hidden rounded-full bg-slate-200 text-slate-700 opacity-80 transition-all duration-200 hover:border-2 hover:border-dashed hover:border-slate-500 hover:opacity-100 dark:bg-slate-700 dark:text-slate-50 dark:hover:border-slate-500"
      [matTooltip]="'Edit Task'"
    >
      <mat-icon class="icon-size-5" [svgIcon]="'duotone:pen'"></mat-icon>
    </button>
    <h4 class="font-sans text-xs font-semibold uppercase text-slate-400">
      Overview
    </h4>
  </div>
  <!-- Task Status -->
  <div
    class="m-0 -ms-1 inline-flex h-6 scale-90 items-center gap-1 rounded-full px-3 py-0.5 text-xs font-semibold"
  >
    <div
      class="rounded-full px-3 py-0.5 text-sm font-semibold"
      [ngClass]="{
        'bg-slate-200 text-slate-800 dark:bg-slate-500 dark:text-slate-50':
          task.status === 'OPEN',
        'bg-blue-200 text-blue-800 dark:bg-blue-500 dark:text-blue-50':
          task.status === 'IN_PROGRESS',
        'bg-amber-200 text-amber-800 dark:bg-amber-500 dark:text-amber-50':
          task.status === 'RESOLVED',
        'bg-green-200 text-green-800 dark:bg-green-500 dark:text-green-50':
          task.status === 'COMPLETED',
        'bg-red-200 text-red-800 dark:bg-red-500 dark:text-red-50':
          task.status === 'CLOSED'
      }"
    >
      {{ task.status }}
    </div>
  </div>
</div>

<div
  class="border-b border-slate-200 pb-6 dark:border-slate-700"
  *ngrxLet="task$ as task"
>
  <!-- Task Name -->
  <div class="mb-2 text-lg font-medium leading-6">
    {{ task.title }}
  </div>

  <!-- Task Description -->
  <div class="text-sm font-normal leading-6 text-slate-500 dark:text-slate-400">
    {{ task.description }}
  </div>

  <!-- Task Assigned -->
  <div class="mt-4 flex items-center justify-between gap-2">
    <!-- Avatar User Assigned -->
    <div class="flex shrink-0 items-center gap-3">
      <img
        class="flex-0 h-7 w-7 rounded-full object-cover shadow-sm ring-2 ring-gray-800"
        [src]="task.assignee.info.avatar"
        [matTooltip]="task.assignee.info.name"
        alt="Avatar"
      />
      <div>
        <div class="text-base font-medium leading-5">Assigned to</div>
        <div class="text-secondary text-md font-normal leading-4">
          {{ task.assignee.info.name }}
        </div>
      </div>
    </div>

    <!-- Process Task -->
    <div class="max-w-30 grow">
      <div class="mb-2 text-sm leading-none text-slate-400">
        {{ progressTodo | async | percent }}% complete
      </div>

      <mat-progress-bar
        class="overflow-hidden rounded-full"
        [color]="
          (progressTodo | async) === 1
            ? 'primary'
            : (progressTodo | async) >= 0.5
              ? 'accent'
              : 'warn'
        "
        mode="determinate"
        [value]="(progressTodo | async) * 100"
      />
    </div>
  </div>
</div>
<div
  class="border-b border-slate-200 py-6 dark:border-slate-700"
  *ngrxLet="task$ as task"
>
  <h4 class="font-sans text-sm font-semibold uppercase text-slate-400">
    Todo List ({{ task.todos.length }})
  </h4>
  <ng-container *ngIf="task.todos.length > 0 || !permissionTodo; else noToDo">
    <div class="mx-2 mt-4 space-y-1.5">
      <ng-container *ngFor="let todo of task.todos; trackBy: trackByFn">
        <div class="group flex items-center">
          <mat-checkbox
            class="flex items-center"
            [color]="'primary'"
            [disabled]="disbaleTodo || permissionTodo"
            [(ngModel)]="todo.isDone"
            (change)="updateTodoOnTask(todo)"
          ></mat-checkbox>
          <input
            aria-label="Task"
            class="w-full px-1 py-0.5"
            [disabled]="permissionTodo"
            [ngClass]="{
              'text-secondary line-through': todo.isDone
            }"
            [placeholder]="'Task'"
            [(ngModel)]="todo.content"
            (input)="updateTodoOnTask(todo)"
          />
          <mat-icon
            *ngIf="!permissionTodo"
            class="icon-size-5 ml-auto hidden cursor-pointer group-hover:flex"
            [svgIcon]="'heroicons_solid:x-mark'"
            (click)="removeTodoOnTask(todo.id)"
          ></mat-icon>
        </div>
      </ng-container>
      <div class="flex items-center" *ngIf="!permissionTodo">
        <mat-icon
          class="icon-size-5 text-hint -ml-0.5"
          [svgIcon]="'heroicons_solid:plus'"
        ></mat-icon>
        <input
          aria-label="Add task"
          class="ml-1.5 w-full px-1 py-0.5"
          [placeholder]="'Add task'"
          (keydown.enter)="
            addTodoOnTask(task, newTodoInput.value); newTodoInput.value = ''
          "
          #newTodoInput
        />
      </div>
    </div>
  </ng-container>

  <ng-template #noToDo>
    <plan-todo-not-found
      [name]="'Todo List'"
      [icon]="'thin:empty-set'"
    ></plan-todo-not-found>
  </ng-template>
</div>

<!-- Attached Files -->
<div
  class="border-b border-slate-200 py-6 dark:border-slate-700"
  *ngrxLet="task$ as task"
>
  <div class="font-sans text-sm font-semibold uppercase text-slate-400">
    Attached Files ({{ task.files.length }})
  </div>

  <ng-container *ngIf="task.files.length > 0; else noFiles"> </ng-container>

  <ng-template #noFiles>
    <plan-todo-not-found
      [name]="'attached files'"
      [icon]="'thin:file-xmark'"
    ></plan-todo-not-found>
  </ng-template>
</div>

<!-- Comment -->
<plan-todo-comment [task]="task$ | ngrxPush"></plan-todo-comment>
